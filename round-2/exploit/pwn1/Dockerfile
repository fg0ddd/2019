FROM i386/ubuntu:xenial

RUN adduser --disabled-password --gecos '' ctf

RUN apt-get update && apt-get install -y xinetd

WORKDIR /home/ctf

ADD src/flag.txt /home/ctf
RUN chown root.root /home/ctf/flag.txt
RUN chmod 0644 /home/ctf/flag.txt

ADD src/pwn1 /home/ctf/
RUN chown root.root /home/ctf/pwn1
RUN chmod 0755 /home/ctf/pwn1

# Set up xinetd
ADD xinetd.conf /etc/xinetd.conf
RUN mkdir /var/log/xinetd/

ADD pwn1.xinetd /etc/xinetd.d/pwn1

USER root
EXPOSE 5252

CMD service xinetd restart && tail -F /var/log/xinetd/xinetd.log
